---
services:
  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    network_mode: "host"
    labels:
      - "app=plex"
      - "managed-by=gitops"
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - VERSION=docker
    volumes:
      - '${PLEX_CONFIG_PATH}:/config'
      - '${PLEX_TV_PATH}:/data/media/TV'
      - '${PLEX_MOVIES_PATH}:/data/media/Movies'
    devices:
      - /dev/dri:/dev/dri
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:32400/identity"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    tmpfs:
      - /transcode:rw,size=${PLEX_TRANSCODE_SIZE}
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    restart: unless-stopped
